{"id":176,"date":"2021-04-06T17:40:36","date_gmt":"2021-04-06T17:40:36","guid":{"rendered":"http:\/\/gabybot.com\/?page_id=176"},"modified":"2025-08-19T01:30:29","modified_gmt":"2025-08-19T01:30:29","slug":"speed-control","status":"publish","type":"page","link":"http:\/\/gabybot.com\/speed-control\/","title":{"rendered":"Speed Control"},"content":{"rendered":"\n<p>Now that we know how to use the encoders, we want to change our&nbsp;<strong>DriveSubsystem<\/strong>&nbsp;class so that we can set the motors to run at a specific <strong>speed<\/strong> by automatically&nbsp;adjusting the power of the motors to maintain that speed.<\/p>\n\n\n\n<p>Before we tackle that, however, we need to gather some information as to the relationship between the power applied to the motors and their speed. We are going to create a new command where we will run the robot forward at different power settings and record the speed that results.<\/p>\n\n\n\n<p>Start by adding a new class&nbsp;<strong>TestMotorSpeedCommand<\/strong>&nbsp;to the&nbsp;<strong>commands<\/strong>&nbsp;folder, and copy the contents of&nbsp;<strong>ExampleCommand.java<\/strong>&nbsp;replacing the&nbsp;<strong>ExampleCommand<\/strong>&nbsp;and&nbsp;<strong>ExampleSubsystem<\/strong>&nbsp;strings. Your result should look like:<\/p>\n\n\n\n<pre class=\"wp-block-code\"><code>\/*----------------------------------------------------------------------------*\/\n\/* Copyright (c) 2018-2019 FIRST. All Rights Reserved.                        *\/\n\/* Open Source Software - may be modified and shared by FRC teams. The code   *\/\n\/* must be accompanied by the FIRST BSD license file in the root directory of *\/\n\/* the project.                                                               *\/\n\/*----------------------------------------------------------------------------*\/\n\npackage frc.robot.commands;\n\nimport edu.wpi.first.wpilibj2.command.Command;\nimport frc.robot.subsystems.DriveSubsystem;\nimport robotCore.Logger;\n\n\/**\n * A command to test the relationship between speed and power.\n *\/\npublic class TestMotorSpeedCommand extends Command {\n  private final DriveSubsystem m_subsystem;\n\n  \/**\n   * Creates a new TestMotorSpeedCommand.\n   *\n   * @param subsystem The subsystem used by this command.\n   *\/\n  public TestMotorSpeedCommand(DriveSubsystem subsystem) {\n    Logger.log(\"TestMotorSpeedCommand\", 3, \"TestMotorSpeedCommand()\");\n\n    m_subsystem = subsystem;\n    \/\/ Use addRequirements() here to declare subsystem dependencies.\n    addRequirements(m_subsystem);\n  }\n\n  \/\/ Called when the command is initially scheduled.\n  @Override\n  public void initialize() {\n    Logger.log(\"TestMotorSpeedCommand\", 2, \"initialize()\");\n  }\n\n  \/\/ Called every time the scheduler runs while the command is scheduled.\n  @Override\n  public void execute() {\n    Logger.log(\"TestMotorSpeedCommand\", -1, \"execute()\");\n  }\n\n  \/\/ Called once the command ends or is interrupted.\n  @Override\n  public void end(boolean interrupted) {\n    Logger.log(\"TestMotorSpeedCommand\", 2, String.format(\"end(%b)\", interrupted));\n  }\n\n  \/\/ Returns true when the command should end.\n  @Override\n  public boolean isFinished() {\n    Logger.log(\"TestMotorSpeedCommand\", -1, \"isFinished()\");\n    return false;\n  }\n}\n\n<\/code><\/pre>\n\n\n\n<p>Now what we want to do is to start the robot at&nbsp;<strong>0<\/strong>&nbsp;power and gradually increase the power, recording the speed, until we reach full power. To accomplish this we&nbsp;need to create a member variable&nbsp;<strong>m_power<\/strong>&nbsp;to hold the current power setting. We are also going to want to record the speed of the motors so we will need an&nbsp;<strong><a href=\"\/RobotCoreDoc\/classrobot_core_1_1_encoder.html\" target=\"_blank\" rel=\"noreferrer noopener\">Encoder<\/a><\/strong>&nbsp;instance for the left and right encoders.<\/p>\n\n\n\n<pre class=\"wp-block-code\"><code>\/*----------------------------------------------------------------------------*\/\n\/* Copyright (c) 2018-2019 FIRST. All Rights Reserved.                        *\/\n\/* Open Source Software - may be modified and shared by FRC teams. The code   *\/\n\/* must be accompanied by the FIRST BSD license file in the root directory of *\/\n\/* the project.                                                               *\/\n\/*----------------------------------------------------------------------------*\/\n\npackage frc.robot.commands;\n\nimport edu.wpi.first.wpilibj2.command.Command;\nimport frc.robot.subsystems.DriveSubsystem;\nimport robotCore.Encoder;\nimport robotCore.Logger;\n\n\/**\n * A command to test the relationship between speed and power.\n *\/\npublic class TestMotorSpeedCommand extends Command {\n  private final DriveSubsystem m_subsystem;\n\n  \/\/Current power\n  private double m_power;\n\n  \/\/Encoder objects, left and right\n  private final Encoder m_leftEncoder;\n  private final Encoder m_rightEncoder;\n\n  \/**\n   * Creates a new TestMotorSpeedCommand.\n   *\n   * @param subsystem The subsystem used by this command.\n   *\/\n  public TestMotorSpeedCommand(DriveSubsystem subsystem) {\n    Logger.log(\"TestMotorSpeedCommand\", 3, \"TestMotorSpeedCommand()\");\n\n    m_subsystem = subsystem;\n\n    m_leftEncoder = subsystem.getLeftEncoder();\n    m_rightEncoder = subsystem.getRightEncoder();\n\n    \/\/ Use addRequirements() here to declare subsystem dependencies.\n    addRequirements(m_subsystem);\n  }<\/code><\/pre>\n\n\n\n<p>As we&#8217;ve seen before, we declare the class variables right after <em>class<\/em> command to reserve these names for <strong><em>Encoder<\/em> <\/strong>objects, then in the constructor we get the left and right <strong><em>Encoder<\/em> <\/strong>objects from the subsystem, and assign them to our class variables.  This gives access to the <strong><em>Encoder<\/em> <\/strong>objects to every method in this class.<\/p>\n\n\n\n<p>In the&nbsp;<strong>initialize()<\/strong>&nbsp;function we need to set the power to&nbsp;<strong>0<\/strong>. Also we will be logging the motor speeds in the&nbsp;<strong>execute()<\/strong>&nbsp;function in a format that will allow us to import them into a spreadsheet. To make the spreadsheet easier to read we add a title row which labels each column. Notice the <strong>comma<\/strong> at the beginning of the <strong>&#8220;,Power, Left, Right&#8221;<\/strong> string. This is necessary in order to properly import the output into our spreadsheet.<\/p>\n\n\n\n<pre class=\"wp-block-code\"><code>  public void initialize() {\n    Logger.log(\"TestMotorSpeedCommand\", 2, \"initialize()\");\n\n    \/\/Write header for power data in log    \n    Logger.log(\"TestMotorSpeedCommand\", 0, \",Power,Left,Right\");\n\n    m_power = 0;\n  }<\/code><\/pre>\n\n\n\n<p>Then in the&nbsp;<strong>execute()<\/strong>&nbsp;function we will set the drive power to the current power and then increase the power by&nbsp;<strong>0.0025<\/strong>&nbsp;each time we are called. We will use the <strong><a rel=\"noreferrer noopener\" href=\"\/RobotCoreDoc\/classrobot_core_1_1_encoder.html#ae4c8de122a428bbec1380d072b1a1014\" target=\"_blank\">getSpeed()<\/a><\/strong> function of the <strong><a rel=\"noreferrer noopener\" href=\"\/RobotCoreDoc\/classrobot_core_1_1_encoder.html\" target=\"_blank\">Encoder<\/a><\/strong> class and <em><strong><a href=\"\/RobotCoreDoc\/classrobot_core_1_1_logger.html#a10c76e404fc1432e8c1ba1e7c26e44dc\" target=\"_blank\" rel=\"noreferrer noopener\">Logger.log()<\/a><\/strong><\/em> to log the speeds of the two motors so that we can view them later. To accomplish this we change the&nbsp;<strong>execute()<\/strong>&nbsp;function as follows:<\/p>\n\n\n\n<pre class=\"wp-block-code\"><code>  public void execute() {\n    Logger.log(\"TestMotorSpeedCommand\", -1, \"execute()\");\n\n    Logger.log(\"TestMotorSpeedCommand\", 0,\n        String.format(\",%f,%d,%d\", m_power, m_leftEncoder.getSpeed(), m_rightEncoder.getSpeed()));\n\n    m_subsystem.setPower(m_power, m_power);\n\n    m_power += 0.0025;\n  }<\/code><\/pre>\n\n\n\n<p>Note that we do not need to put these in a <strong><em>for<\/em> <\/strong>loop, since <strong><em>execute<\/em> <\/strong>is called periodically by the <strong>WPILib <\/strong>framework, so we get it for free!<\/p>\n\n\n\n<p>Then we need to change the&nbsp;<strong>isFinished()<\/strong>&nbsp;function to return&nbsp;<strong>true<\/strong>&nbsp;when the power exceeds&nbsp;<strong>1.3.<\/strong>&nbsp;Note that we are increasing the power up to&nbsp;<strong>1.3<\/strong>&nbsp;even though the highest power the motor will accept is&nbsp;<strong>1.0<\/strong>&nbsp;(anything over that will be treated the same as&nbsp;<strong>1.0<\/strong>). The reason we are doing this is to see exactly where the speed tops out.<\/p>\n\n\n\n<pre class=\"wp-block-code\"><code>  public boolean isFinished() {\n    Logger.log(\"TestMotorSpeedCommand\", -1, \"isFinished()\");\n    return m_power &gt; 1.3;\n  }<\/code><\/pre>\n\n\n\n<p>Finally when the command is finished, we need to turn the motors off.<\/p>\n\n\n\n<pre class=\"wp-block-code\"><code>  public void end(boolean interrupted) {\n    Logger.log(\"TestMotorSpeedCommand\", 2, String.format(\"end(%b)\", interrupted));\n\n    \/\/ All done. Turn off the motors.\n    m_subsystem.stop();\n  }<\/code><\/pre>\n\n\n\n<p>Your&nbsp;<strong>TestMotorSpeedCommand.java<\/strong>&nbsp;file should now look like:<\/p>\n\n\n\n<pre class=\"wp-block-code\"><code>\/*----------------------------------------------------------------------------*\/\n\/* Copyright (c) 2018-2019 FIRST. All Rights Reserved.                        *\/\n\/* Open Source Software - may be modified and shared by FRC teams. The code   *\/\n\/* must be accompanied by the FIRST BSD license file in the root directory of *\/\n\/* the project.                                                               *\/\n\/*----------------------------------------------------------------------------*\/\n\npackage frc.robot.commands;\n\nimport edu.wpi.first.wpilibj2.command.Command;\nimport frc.robot.subsystems.DriveSubsystem;\nimport robotCore.Encoder;\nimport robotCore.Logger;\n\n\/**\n * A command to test the relationship between speed and power.\n *\/\npublic class TestMotorSpeedCommand extends Command {\n  private final DriveSubsystem m_subsystem;\n\n  \/\/ Current power\n  private double m_power;\n\n  \/\/ Encoder objects, left and right\n  private final Encoder m_leftEncoder;\n  private final Encoder m_rightEncoder;\n\n  \/**\n   * Creates a new TestMotorSpeedCommand.\n   *\n   * @param subsystem The subsystem used by this command.\n   *\/\n  public TestMotorSpeedCommand(DriveSubsystem subsystem) {\n    Logger.log(\"TestMotorSpeedCommand\", 3, \"TestMotorSpeedCommand()\");\n\n    m_subsystem = subsystem;\n\n    m_leftEncoder = subsystem.getLeftEncoder();\n    m_rightEncoder = subsystem.getRightEncoder();\n\n    \/\/ Use addRequirements() here to declare subsystem dependencies.\n    addRequirements(m_subsystem);\n  }\n\n  \/\/ Called when the command is initially scheduled.\n  @Override\n  public void initialize() {\n    Logger.log(\"TestMotorSpeedCommand\", 2, \"initialize()\");\n\n    \/\/ Write header for power data in log\n    Logger.log(\"TestMotorSpeedCommand\", 0, \",Power,Left,Right\");\n\n    m_power = 0;\n  }\n\n  \/\/ Called every time the scheduler runs while the command is scheduled.\n  @Override\n  public void execute() {\n    Logger.log(\"TestMotorSpeedCommand\", -1, \"execute()\");\n\n    Logger.log(\"TestMotorSpeedCommand\", 0,\n        String.format(\",%f,%d,%d\", m_power, m_leftEncoder.getSpeed(), m_rightEncoder.getSpeed()));\n\n    m_subsystem.setPower(m_power, m_power);\n\n    m_power += 0.0025;\n  }\n\n  \/\/ Called once the command ends or is interrupted.\n  @Override\n  public void end(boolean interrupted) {\n    Logger.log(\"TestMotorSpeedCommand\", 2, String.format(\"end(%b)\", interrupted));\n\n    \/\/ All done. Turn off the motors.\n    m_subsystem.setPower(0, 0);\n  }\n\n  \/\/ Returns true when the command should end.\n  @Override\n  public boolean isFinished() {\n    Logger.log(\"TestMotorSpeedCommand\", -1, \"isFinished()\");\n    return m_power &gt; 1.3;\n  }\n}\n<\/code><\/pre>\n\n\n\n<p>Finally need to have a button&nbsp;on the joystick that will run this command. Switching to the&nbsp;<strong>RobotContainer.java<\/strong>&nbsp;file, we configure it to run our TestMotorSpeedCommand when button 3 is pressed:<\/p>\n\n\n\n<pre class=\"wp-block-code\"><code> private void configureButtonBindings() {\n    m_joystick.button(1).onTrue(new DriveForTimeCommand(m_driveSubsystem, 0.50, 3.0));\n    m_joystick.button(2).onTrue(new DriveForDistanceCommand(m_driveSubsystem, 0.75, 1000));\n    m_joystick.button(3).onTrue(new TestMotorSpeedCommand(m_driveSubsystem));\n  }<\/code><\/pre>\n\n\n\n<p>Now run your program and <strong>connect <\/strong>and <strong>enable <\/strong>your robot. <strong><span style=\"text-decoration: underline;\">Before pressing the&nbsp;B3&nbsp;button<\/span><\/strong> to run our command we want to clear the&nbsp;<strong>TERMINAL<\/strong>&nbsp;in&nbsp;<strong>VS Code<\/strong>. <\/p>\n\n\n\n<p>Unfortunately the only way I have found to do that is a little bit convoluted (A possibly simpler way is at the bottom of this section, but doesn&#8217;t include <em>Select All<\/em>, which we&#8217;ll need later!). First right click on the word&nbsp;<strong>TERMINAL<\/strong>&nbsp;at the bottom of the screen. This will bring up the following menu:<\/p>\n\n\n\n<div class=\"wp-block-image\"><figure class=\"aligncenter size-large\"><img loading=\"lazy\" width=\"308\" height=\"335\" src=\"\/wp-content\/uploads\/2021\/04\/ClearTerminal.jpg\" alt=\"\" class=\"wp-image-188\" srcset=\"http:\/\/gabybot.com\/wp-content\/uploads\/2021\/04\/ClearTerminal.jpg 308w, http:\/\/gabybot.com\/wp-content\/uploads\/2021\/04\/ClearTerminal-276x300.jpg 276w\" sizes=\"(max-width: 308px) 100vw, 308px\" \/><\/figure><\/div>\n\n\n\n<p>Now <strong>ignore <\/strong>this menu and without closing it move the cursor down to the&nbsp;<strong>TERMINAL<\/strong>&nbsp;area and right click. This should then give you the menu:<\/p>\n\n\n\n<div class=\"wp-block-image\"><figure class=\"aligncenter size-large\"><img loading=\"lazy\" width=\"358\" height=\"291\" src=\"\/wp-content\/uploads\/2021\/04\/ClearTerminal2.jpg\" alt=\"\" class=\"wp-image-189\" srcset=\"http:\/\/gabybot.com\/wp-content\/uploads\/2021\/04\/ClearTerminal2.jpg 358w, http:\/\/gabybot.com\/wp-content\/uploads\/2021\/04\/ClearTerminal2-300x244.jpg 300w\" sizes=\"(max-width: 358px) 100vw, 358px\" \/><\/figure><\/div>\n\n\n\n<p>Choose the&nbsp;<strong>Clear<\/strong>&nbsp;option from this menu.<\/p>\n\n\n\n<p>Now press the&nbsp;<strong>B3<\/strong>&nbsp;button on the&nbsp;<strong>Driver Station<\/strong>. The robot should drive forward slowly increasing it speed. When it has stopped, the logged information should be in the&nbsp;<strong>TERMINAL<\/strong>&nbsp;pane:<\/p>\n\n\n\n<div class=\"wp-block-image\"><figure class=\"aligncenter size-large\"><img loading=\"lazy\" width=\"528\" height=\"261\" src=\"\/wp-content\/uploads\/2021\/04\/TestSpeed.jpg\" alt=\"\" class=\"wp-image-190\" srcset=\"http:\/\/gabybot.com\/wp-content\/uploads\/2021\/04\/TestSpeed.jpg 528w, http:\/\/gabybot.com\/wp-content\/uploads\/2021\/04\/TestSpeed-300x148.jpg 300w\" sizes=\"(max-width: 528px) 100vw, 528px\" \/><\/figure><\/div>\n\n\n\n<p>Now we want to select all of the text in this window so we can paste it into our spreadsheet. Unfortunately using the normal Windows shortcut&nbsp;<strong>CTRL + a<\/strong>&nbsp;does not seem to work for some reason. However we can us the same trick that we used to clear the&nbsp;<strong>TERMINAL<\/strong>. First right click on the word&nbsp;<strong>TERMINAL.<\/strong>&nbsp;Then, ignoring that menu, right click on the&nbsp;<strong>TERMINAL<\/strong>&nbsp;window and choose&nbsp;<strong>Select All<\/strong>. Then repeat this procedure and this time choose&nbsp;<strong>Copy<\/strong>.<\/p>\n\n\n\n<p>Now that you have the text copied to the clipboard start up&nbsp;<strong>LibreOffice Calc<\/strong>. Then choose&nbsp;<strong>Edit \/ Paste<\/strong>&nbsp;and you should get the following dialog:<\/p>\n\n\n\n<div class=\"wp-block-image\"><figure class=\"aligncenter size-full is-resized\"><a href=\"\/wp-content\/uploads\/2022\/06\/Import.jpg\"><img loading=\"lazy\" src=\"\/wp-content\/uploads\/2022\/06\/Import.jpg\" alt=\"\" class=\"wp-image-2184\" width=\"466\" height=\"496\" srcset=\"http:\/\/gabybot.com\/wp-content\/uploads\/2022\/06\/Import.jpg 642w, http:\/\/gabybot.com\/wp-content\/uploads\/2022\/06\/Import-282x300.jpg 282w, http:\/\/gabybot.com\/wp-content\/uploads\/2022\/06\/Import-150x160.jpg 150w\" sizes=\"(max-width: 466px) 100vw, 466px\" \/><\/a><\/figure><\/div>\n\n\n\n<p>Make sure the&nbsp;<strong>Comma<\/strong>&nbsp;option is checked under the&nbsp;<strong>Separator Options<\/strong>&nbsp;and then click&nbsp;<strong>OK<\/strong>.<\/p>\n\n\n\n<p>Then select the&nbsp;<strong>Power<\/strong>,&nbsp;<strong>Left<\/strong>&nbsp;and&nbsp;<strong>Right<\/strong>&nbsp;columns (i.e.&nbsp;<strong>D<\/strong>,&nbsp;<strong>E&nbsp;<\/strong>and&nbsp;<strong>F<\/strong>):<\/p>\n\n\n\n<div class=\"wp-block-image\"><figure class=\"aligncenter size-full is-resized\"><a href=\"\/wp-content\/uploads\/2022\/06\/LibreChart.jpg\"><img loading=\"lazy\" src=\"\/wp-content\/uploads\/2022\/06\/LibreChart.jpg\" alt=\"\" class=\"wp-image-2187\" width=\"548\" height=\"298\" srcset=\"http:\/\/gabybot.com\/wp-content\/uploads\/2022\/06\/LibreChart.jpg 741w, http:\/\/gabybot.com\/wp-content\/uploads\/2022\/06\/LibreChart-300x163.jpg 300w, http:\/\/gabybot.com\/wp-content\/uploads\/2022\/06\/LibreChart-150x82.jpg 150w\" sizes=\"(max-width: 548px) 100vw, 548px\" \/><\/a><\/figure><\/div>\n\n\n\n<p>and click the&nbsp;<strong>Insert Chart&nbsp;<\/strong>icon at the top:<\/p>\n\n\n\n<div class=\"wp-block-image\"><figure class=\"aligncenter size-large\"><img loading=\"lazy\" width=\"46\" height=\"40\" src=\"\/wp-content\/uploads\/2021\/04\/LibreCalc3.jpg\" alt=\"\" class=\"wp-image-193\"\/><\/figure><\/div>\n\n\n\n<p>For the chart type choose the&nbsp;<strong>XY (Scatter)<\/strong>&nbsp;and&nbsp;<strong>Lines Only<\/strong>&nbsp;options as shown below:<\/p>\n\n\n\n<div class=\"wp-block-image\"><figure class=\"aligncenter size-large is-resized\"><a href=\"\/wp-content\/uploads\/2021\/04\/LibreCalc41.jpg\"><img loading=\"lazy\" src=\"\/wp-content\/uploads\/2021\/04\/LibreCalc41.jpg\" alt=\"\" class=\"wp-image-782\" width=\"517\" height=\"256\" srcset=\"http:\/\/gabybot.com\/wp-content\/uploads\/2021\/04\/LibreCalc41.jpg 919w, http:\/\/gabybot.com\/wp-content\/uploads\/2021\/04\/LibreCalc41-300x149.jpg 300w, http:\/\/gabybot.com\/wp-content\/uploads\/2021\/04\/LibreCalc41-768x381.jpg 768w\" sizes=\"(max-width: 517px) 100vw, 517px\" \/><\/a><\/figure><\/div>\n\n\n\n<p>Now there are two different kinds of motors that can be on your <strong>Minibot<\/strong>. They both run at the same speed but one has a higher resolution encoder than the other. Here is a plot of what you might see for each motor type:<\/p>\n\n\n\n<div class=\"wp-block-image\"><figure class=\"aligncenter size-large is-resized\"><a href=\"\/wp-content\/uploads\/2025\/08\/Ramp-1.jpg\"><img loading=\"lazy\" src=\"\/wp-content\/uploads\/2025\/08\/Ramp-1-1024x299.jpg\" alt=\"\" class=\"wp-image-4764\" width=\"593\" height=\"173\" srcset=\"http:\/\/gabybot.com\/wp-content\/uploads\/2025\/08\/Ramp-1-1024x299.jpg 1024w, http:\/\/gabybot.com\/wp-content\/uploads\/2025\/08\/Ramp-1-300x88.jpg 300w, http:\/\/gabybot.com\/wp-content\/uploads\/2025\/08\/Ramp-1-150x44.jpg 150w, http:\/\/gabybot.com\/wp-content\/uploads\/2025\/08\/Ramp-1-768x224.jpg 768w, http:\/\/gabybot.com\/wp-content\/uploads\/2025\/08\/Ramp-1.jpg 1491w\" sizes=\"(max-width: 593px) 100vw, 593px\" \/><\/a><\/figure><\/div>\n\n\n\n<p>This is a plot of the&nbsp;<strong>motor speed<\/strong>&nbsp;vs the&nbsp;<strong>power<\/strong>&nbsp;applied. There are several things we can see from looking at the graph. For the purposes of the following discussions we will assume that you have the motor on the left. We will show the associated values for the motor on the right in blue parenthesis.<\/p>\n\n\n\n<p><strong><strong>Note that these are&nbsp;the results for this particular robot. Your robot may differ and you should adjust these numbers accordingly.&nbsp;<\/strong><\/strong><\/p>\n\n\n\n<p>The first is that the motors will not even start running until the power reaches about&nbsp;<strong>0.42<\/strong> and tops out when the power reaches <strong>1.0<\/strong> (a power of <strong>1.0<\/strong> represents running the motor at full power). The second is that the left motor is less powerful than the right which is the reason the robot turns left. The last takeaway is that the max speed for the right motor is about&nbsp;<strong>1500 <font color=\"blue\">(<strong>530<\/strong>)<\/font><\/strong> and the max speed of the left motor is about&nbsp;<strong>1480 <font color=\"blue\">(<strong>480<\/strong>)<\/font><\/strong>. If we want the robot to drive straight then the max speed for the whole robot will need to be limited to the slower motor (i.e.&nbsp;<strong>1480 <font color=\"blue\">(<strong>480<\/strong>)<\/font><\/strong>). So let&#8217;s define a constant for that max speed (in <strong>DriveSubsystem<\/strong>):<\/p>\n\n\n\n<pre class=\"wp-block-code\"><code>\npublic class DriveSubsystem extends SubsystemBase {\n  private PWMMotor m_leftMotor = new PWMMotor(Minibot.LeftMotorPWM, Minibot.LeftMotorDir);\n  private PWMMotor m_rightMotor = new PWMMotor(Minibot.RightMotorPWM, Minibot.RightMotorDir);\n  private Encoder m_leftEncoder = new Encoder(EncoderType.Quadrature, Minibot.LeftEncoderInt, Minibot.LeftEncoderDir);\n  private Encoder m_rightEncoder = new Encoder(EncoderType.Quadrature, Minibot.RightEncoderInt,\n      Minibot.RightEncoderDir);\n\n  public static final double k_maxSpeed = 1480;        \/\/ Use the correct number for your robot!<\/code><\/pre>\n\n\n\n<p>Note that we have made <strong>k_maxSpeed<\/strong>&nbsp;public here. This is so we can later use it to log the target speed in the units of the encoders.<\/p>\n\n\n\n<p>The other thing we need to glean from this graph is the minimum power needed to get the motors running. Looking at the graph we might choose a number like <strong>0.4<\/strong> but what we really want is imagine where the straight point of the graph would intersect the x-axis if we extended it. You can make a good estimate by looking at the picture but if you want to be precise, you can plot just the linear portion of the graph and then fit a line to the data. Doing this for the left motor we would see:<\/p>\n\n\n\n<div class=\"wp-block-image\"><figure class=\"aligncenter size-large is-resized\"><a href=\"\/wp-content\/uploads\/2025\/08\/RampMinPower.jpg\"><img loading=\"lazy\" src=\"\/wp-content\/uploads\/2025\/08\/RampMinPower-1024x287.jpg\" alt=\"\" class=\"wp-image-4775\" width=\"568\" height=\"159\" srcset=\"http:\/\/gabybot.com\/wp-content\/uploads\/2025\/08\/RampMinPower-1024x287.jpg 1024w, http:\/\/gabybot.com\/wp-content\/uploads\/2025\/08\/RampMinPower-300x84.jpg 300w, http:\/\/gabybot.com\/wp-content\/uploads\/2025\/08\/RampMinPower-150x42.jpg 150w, http:\/\/gabybot.com\/wp-content\/uploads\/2025\/08\/RampMinPower-768x215.jpg 768w, http:\/\/gabybot.com\/wp-content\/uploads\/2025\/08\/RampMinPower.jpg 1499w\" sizes=\"(max-width: 568px) 100vw, 568px\" \/><\/a><\/figure><\/div>\n\n\n\n<p>We can see that the line intersect the axis at around <strong>0.35 <mark style=\"background-color:rgba(0, 0, 0, 0)\" class=\"has-inline-color has-neve-link-color-color\">(0.25)<\/mark><\/strong>. If we want a more precise value we can get it from the function by dividing 783 by 2047 <mark style=\"background-color:rgba(0, 0, 0, 0)\" class=\"has-inline-color has-neve-link-color-color\">(148 by 641)<\/mark> which gives <strong>0.38 <mark style=\"background-color:rgba(0, 0, 0, 0)\" class=\"has-inline-color has-neve-link-color-color\">(0.23)<\/mark><\/strong>. Doing the same for the right motor we would get <strong>0.36 <mark style=\"background-color:rgba(0, 0, 0, 0)\" class=\"has-inline-color has-neve-link-color-color\">(0.21)<\/mark><\/strong>. Define constants for these values:<\/p>\n\n\n\n<pre class=\"wp-block-code\"><code>public class DriveSubsystem extends SubsystemBase {\n  private PWMMotor m_leftMotor = new PWMMotor(Minibot.LeftMotorPWM, Minibot.LeftMotorDir);\n  private PWMMotor m_rightMotor = new PWMMotor(Minibot.RightMotorPWM, Minibot.RightMotorDir);\n  private Encoder m_leftEncoder = new Encoder(EncoderType.Quadrature, Minibot.LeftEncoderInt, Minibot.LeftEncoderDir);\n  private Encoder m_rightEncoder = new Encoder(EncoderType.Quadrature, Minibot.RightEncoderInt,\n      Minibot.RightEncoderDir);\n\n  public static final double k_maxSpeed = 1480; \/\/ Use the correct number for your robot!\n  public static final double k_minLeftPower = 0.35; \/\/ Use the correct number for your robot!\n  public static final double k_minRightPower = 0.38; \/\/ Use the correct number for your robot!<\/code><\/pre>\n\n\n\n<p><strong>Note that these are&nbsp;the results for this particular robot. Your robot may differ and you should adjust these numbers accordingly.&nbsp;<\/strong><\/p>\n\n\n\n<h4>PID Controllers, and How to Tune Them<\/h4>\n\n\n\n<p>Our <a href=\"\/RobotCoreDoc\/classrobot_core_1_1_p_w_m_motor.html#a51a53e0822eaa072286239e99cc2159e\">PWMMotor&nbsp;<\/a>class inherits (outside of our code) from the&nbsp;<a rel=\"noreferrer noopener\" href=\"\/RobotCoreDoc\/classrobot_core_1_1_smart_motor.html\" target=\"_blank\">SmartMotor&nbsp;<\/a>class.  &nbsp;<a rel=\"noreferrer noopener\" href=\"\/RobotCoreDoc\/classrobot_core_1_1_smart_motor.html\" target=\"_blank\">SmartMotor&nbsp;<\/a>has a way to map a requested motor <strong><em>speed<\/em> <\/strong>to a motor <em><strong>power<\/strong><\/em>.  Using this, our code only needs to be concerned with speed, and let <a rel=\"noreferrer noopener\" href=\"\/RobotCoreDoc\/classrobot_core_1_1_smart_motor.html\" target=\"_blank\">SmartMotor&nbsp;<\/a>command the motors yield that speed.  That&#8217;s the good news, since we understand <em>robot speed<\/em> and want to use that in our planning and our code, and not worry about how that happens.  Yep, that&#8217;s the good news.<\/p>\n\n\n\n<p>The bad news is that we need to tune <a rel=\"noreferrer noopener\" href=\"\/RobotCoreDoc\/classrobot_core_1_1_smart_motor.html\" target=\"_blank\">SmartMotor<\/a>&#8216;s algorithm with specific values for our motors, so there&#8217;s some work to be done up front.  Details&#8230; <\/p>\n\n\n\n<p>The&nbsp;<a rel=\"noreferrer noopener\" href=\"\/RobotCoreDoc\/classrobot_core_1_1_smart_motor.html\" target=\"_blank\">SmartMotor&nbsp;<\/a>class controls the speed of the motor using a&nbsp;<strong>PID<\/strong>&nbsp;controller.&nbsp;&nbsp;<strong>PID<\/strong>&nbsp;stands for&nbsp;<strong>Proportional,&nbsp;Integral, Differential<\/strong>.&nbsp; When we use this control mechanism, we will set a target for the speed we desire (called the&nbsp;<strong>setPoint<\/strong>) and the&nbsp;<a rel=\"noreferrer noopener\" href=\"\/RobotCoreDoc\/classrobot_core_1_1_smart_motor.html\" target=\"_blank\">SmartMotor&nbsp;<\/a>class will adjust the power sent to the motor&nbsp;based on the following formula:<\/p>\n\n\n\n<pre class=\"wp-block-code\"><code>  power = (P * error) + (I * totalError) + (D * deltaError) + (F * setPoint)<\/code><\/pre>\n\n\n\n<p>where<\/p>\n\n\n\n<ul><li><strong>P<\/strong>&nbsp;\u2013 represents the proportional scale factor.<\/li><li><strong>error<\/strong>&nbsp;\u2013 represents the difference between the current&nbsp;<strong>speed<\/strong>&nbsp;and the&nbsp;<strong>setPoint<\/strong>.<\/li><li><strong>I<\/strong>&nbsp;\u2013 represents the integral scale factor.<\/li><li><strong>totalError<\/strong>&nbsp;\u2013 represents the total accumulated error over time.<\/li><li><strong>D<\/strong>&nbsp;\u2013 represents the derivative scale factor.<\/li><li><strong><b>deltaError<\/b>&nbsp;<\/strong>\u2013 represents the difference between the current error and the last.<\/li><li><strong>F<\/strong>&nbsp;\u2013 represents the constant scale factor which is proportional to the&nbsp;<strong>setPoint<\/strong>.<\/li><li><strong>setPoint<\/strong>&nbsp;\u2013 represents the current target speed.<\/li><\/ul>\n\n\n\n<p>The trick is picking the right combination of&nbsp;<strong>P, I, D<\/strong>&nbsp;and&nbsp;<strong>F<\/strong>&nbsp;to make the motor behave like you want. Here&#8217;s how:<\/p>\n\n\n\n<p>We will start with the&nbsp;<strong>F<\/strong>&nbsp;term which represents a constant power which proportional to the&nbsp;<strong>setPoint<\/strong>. &nbsp;Now we know (from our graph&#8230;change the numbers below for <em>your<\/em> graph) that at full power the maximum speed of the right motor is about&nbsp;<strong>maxSpeed<\/strong> <strong>1480<\/strong> (<strong><font color=\"blue\">480<\/font><\/strong>) units\/sec. &nbsp;Thus we need an&nbsp;<strong>F<\/strong>&nbsp;term that, when multiplied by the max speed will result in full power being applied (i.e. a power of&nbsp;<strong>1.0<\/strong>). &nbsp;That number is&nbsp;<strong>1.0\/maxSpeed<\/strong>. <\/p>\n\n\n\n<p>Note that setting only the&nbsp;constant term, <strong>F<\/strong>,  is essentially the same as controlling the motor by power alone.  No adjustments will occur if there is more or less resistance to the motors, and the motors will slow down or speed up. However, we want to get this term set so that the motors run&nbsp;<strong>close<\/strong>&nbsp;to the target speed we desire.<\/p>\n\n\n\n<p>The first thing we need to do however is to tell the motor controller about the motors&#8217; minimum power requirements. We do this by calling <strong><a rel=\"noreferrer noopener\" href=\"\/RobotCoreDoc\/classrobot_core_1_1_smart_motor.html#adacdf5d231f73e634077eb21d85a13a8\" target=\"_blank\">setMinPower<\/a><\/strong> in the <strong>DriveSubsystem <\/strong>constructor using the constants that we previously defined:<\/p>\n\n\n\n<pre class=\"wp-block-code\"><code>    m_leftMotor.setMinPower(k_minLeftPower);\n    m_rightMotor.setMinPower(k_minRightPower);<\/code><\/pre>\n\n\n\n<p>Next we set the&nbsp;<strong>F<\/strong>&nbsp;terms, by calling <strong><a rel=\"noreferrer noopener\" href=\"\/RobotCoreDoc\/classrobot_core_1_1_smart_motor.html#a049efdcb0ef5df4ba5803eab8a20498f\" target=\"_blank\">setFTerm <\/a><\/strong>in the&nbsp;<strong>DriveSubsystem<\/strong>&nbsp;constructor:<\/p>\n\n\n\n<pre class=\"wp-block-code\"><code>    m_leftMotor.setFTerm(k_Fleft);\n    m_rightMotor.setFTerm(k_Fright);<\/code><\/pre>\n\n\n\n<p>Where we have defined:<\/p>\n\n\n\n<pre class=\"wp-block-code\"><code>  private static final double k_Fleft = 1.0\/k_maxSpeed;\n  private static final double k_Fright = 1.0\/k_maxSpeed;<\/code><\/pre>\n\n\n\n<p>In order for the motor controller to control the speed of the motors, it will need to know what encoders are being used to measure the speed. We set that by calling <strong><a href=\"\/RobotCoreDoc\/classrobot_core_1_1_smart_motor.html#a5787f96d5a49ab7c42ce5e0751ca5f9f\">setFeedbackDevice()<\/a><\/strong> for the motors in the&nbsp;<strong>DriveSubsystem<\/strong>&nbsp;constructor as follows:<\/p>\n\n\n\n<pre class=\"wp-block-code\"><code>    m_leftMotor.setFeedbackDevice(m_leftEncoder);\n    m_rightMotor.setFeedbackDevice(m_rightEncoder);<\/code><\/pre>\n\n\n\n<p>Next&nbsp;we want to set a scale factor so when we want to set the speed, we can just use a range from&nbsp;<strong>-1.0<\/strong>&nbsp;to&nbsp;<strong>+1.0<\/strong>&nbsp;(like we do when controlling the motors by power). Otherwise we would need to set the speed based on the arbitrary units of the encoder which is cumbersome and not intuitive. We do this by calling <strong><a rel=\"noreferrer noopener\" href=\"\/RobotCoreDoc\/classrobot_core_1_1_smart_motor.html#aacbea70f88c25cac67e9039e11ad07e1\" target=\"_blank\">setMaxSpeed<\/a> <\/strong>in the constructor:<\/p>\n\n\n\n<pre class=\"wp-block-code\"><code>m_leftMotor.setMaxSpeed(k_maxSpeed);\nm_rightMotor.setMaxSpeed(k_maxSpeed);<\/code><\/pre>\n\n\n\n<p>Finally, we could change the&nbsp;<strong>setPower<\/strong>&nbsp;function of our&nbsp;<strong>DriveSubsystem<\/strong>&nbsp;class to set the speed instead of power, but there may be a time in the future where we still want to control the power. &nbsp;Therefore, we will create a new function&nbsp;<strong>setSpeed<\/strong>&nbsp;which we will use to set the speed as follows:<\/p>\n\n\n\n<pre class=\"wp-block-code\"><code>  \/\/Sets the speed for the motors\n  public void setSpeed(double leftSpeed, double rightSpeed) {\n    m_leftMotor.setControlMode(SmartMotorMode.Speed);\n    m_rightMotor.setControlMode(SmartMotorMode.Speed);\n\n    m_leftMotor.set(leftSpeed);\n    m_rightMotor.set(rightSpeed);\n  }<\/code><\/pre>\n\n\n\n<p>Note that we must ensure that the controller is in speed mode (not power mode) by calling the <strong><a rel=\"noreferrer noopener\" href=\"\/RobotCoreDoc\/classrobot_core_1_1_smart_motor.html#a13d7a14e9d635be388622e79c8cf5e67\" target=\"_blank\">setControlMode<\/a>&nbsp;<\/strong>function. Then we set the desired speeds.<\/p>\n\n\n\n<p>We also need to change the&nbsp;<strong>setPower<\/strong>&nbsp;function&nbsp;to set the control mode back to power by adding the following to&nbsp;<strong>setPower<\/strong>:<\/p>\n\n\n\n<pre class=\"wp-block-code\"><code>  public void setPower(double leftPower, double rightPower) {\n    m_leftMotor.setControlMode(SmartMotorMode.Power);\n    m_rightMotor.setControlMode(SmartMotorMode.Power);\n\n    m_rightMotor.set(rightPower);\n    m_leftMotor.set(leftPower);\n  }<\/code><\/pre>\n\n\n\n<p>Your&nbsp;<strong>DriveSubsystem.java<\/strong>&nbsp;file should now look something like:<\/p>\n\n\n\n<pre class=\"wp-block-code\"><code>\/*----------------------------------------------------------------------------*\/\n\/* Copyright (c) 2018-2019 FIRST. All Rights Reserved.                        *\/\n\/* Open Source Software - may be modified and shared by FRC teams. The code   *\/\n\/* must be accompanied by the FIRST BSD license file in the root directory of *\/\n\/* the project.                                                               *\/\n\/*----------------------------------------------------------------------------*\/\n\npackage frc.robot.subsystems;\n\nimport edu.wpi.first.wpilibj2.command.SubsystemBase;\nimport robotCore.Logger;\nimport robotCore.Minibot;\nimport robotCore.PWMMotor;\nimport robotCore.SmartMotor.SmartMotorMode;\nimport robotCore.Encoder;\nimport robotCore.Encoder.EncoderType;\n\npublic class DriveSubsystem extends SubsystemBase {\n  private PWMMotor m_leftMotor = new PWMMotor(Minibot.LeftMotorPWM, Minibot.LeftMotorDir);\n  private PWMMotor m_rightMotor = new PWMMotor(Minibot.RightMotorPWM, Minibot.RightMotorDir);\n  private Encoder m_leftEncoder = new Encoder(EncoderType.Quadrature, Minibot.LeftEncoderInt, Minibot.LeftEncoderDir);\n  private Encoder m_rightEncoder = new Encoder(EncoderType.Quadrature, Minibot.RightEncoderInt,\n      Minibot.RightEncoderDir);\n\n  public static final double k_maxSpeed = 1480; \/\/ Use the correct number for your robot!\n  public static final double k_minLeftPower = 0.38; \/\/ Use the correct number for your robot!\n  public static final double k_minRightPower = 0.36; \/\/ Use the correct number for your robot!\n  private static final double k_Fleft = 1.0 \/ k_maxSpeed;\n  private static final double k_Fright = 1.0 \/ k_maxSpeed;\n\n  \/**\n   * Creates a new DriveSubsystem.\n   *\/\n  public DriveSubsystem() {\n    Logger.log(\"DriveSubsystem\", 3, \"DriveSubsystem()\");\n\n    m_rightEncoder.setInverted(true);\n\n    m_leftMotor.setMinPower(k_minLeftPower);\n    m_rightMotor.setMinPower(k_minRightPower);\n    m_leftMotor.setFTerm(k_Fleft);\n    m_rightMotor.setFTerm(k_Fright);\n    m_leftMotor.setFeedbackDevice(m_leftEncoder);\n    m_rightMotor.setFeedbackDevice(m_rightEncoder);\n    m_leftMotor.setMaxSpeed(k_maxSpeed);\n    m_rightMotor.setMaxSpeed(k_maxSpeed);\n  }\n\n  public void setPower(double leftPower, double rightPower) {\n    m_leftMotor.setControlMode(SmartMotorMode.Power);\n    m_rightMotor.setControlMode(SmartMotorMode.Power);\n\n    m_rightMotor.set(rightPower);\n    m_leftMotor.set(leftPower);\n  }\n\n  public void setSpeed(double leftSpeed, double rightSpeed) {\n    m_leftMotor.setControlMode(SmartMotorMode.Speed);\n    m_rightMotor.setControlMode(SmartMotorMode.Speed);\n\n    m_leftMotor.set(leftSpeed);\n    m_rightMotor.set(rightSpeed);\n  }\n\n  public void stop() {\n    setPower(0, 0);\n  }\n\n  \/\/ Return the left encoder value\n  public Encoder getLeftEncoder() {\n    return (m_leftEncoder);\n  }\n\n  \/\/ Return the right encoder value\n  public Encoder getRightEncoder() {\n    return (m_rightEncoder);\n  }\n\n  @Override\n  public void periodic() {\n    \/\/ This method will be called once per scheduler run\n    Logger.log(\"DriveSubsystem\", -1, \"periodic()\");\n  }\n}\n<\/code><\/pre>\n\n\n\n<p>Next we want to add a new command that we can use to test out our speed control. Create a new class under the&nbsp;<strong>commands<\/strong>&nbsp;folder called&nbsp;<strong>CalibrateSpeedCommand<\/strong>&nbsp;and, as before:<\/p>\n\n\n\n<ul><li>Copy over the code from&nbsp;<strong>ExampleCommand<\/strong><\/li><li>Rename the the .java file to <strong>CalibrateSpeedCommand.java<\/strong><\/li><li>Replace&nbsp;<strong>ExampleCommand<\/strong> with <strong>CalibrateSpeedCommand<\/strong>.<\/li><li>Replace <strong>ExampleSubsystem<\/strong> with <strong>DriveSubsystem<\/strong>.<\/li><\/ul>\n\n\n\n<p>Now for this test, we are simply going to run the robot at a constant speed and log the results so that we can see how close to that speed we come. Since we will be logging the motor speeds, we will need access to the left and right encoders so we declare member variables to hold those values, create the Encoder import, and initialize them in the constructor:<\/p>\n\n\n\n<pre class=\"wp-block-code\"><code>public class CalibrateSpeedCommand extends Command {\n  private final DriveSubsystem m_subsystem;\n  private final Encoder m_leftEncoder;\n  private final Encoder m_rightEncoder;\n\n  \/**\n   * Creates a new CalibrateSpeedCommand.\n   *\n   * @param subsystem The subsystem used by this command.\n   *\/\n  public CalibrateSpeedCommand(DriveSubsystem subsystem) {\n    Logger.log(\"CalibrateSpeedCommand\", 3, \"CalibrateSpeedCommand()\");\n\n    m_subsystem = subsystem;\n\n    m_leftEncoder = m_subsystem.getLeftEncoder();\n    m_rightEncoder = m_subsystem.getRightEncoder();\n\n    \/\/ Use addRequirements() here to declare subsystem dependencies.\n    addRequirements(m_subsystem);\n  }<\/code><\/pre>\n\n\n\n<p>In the&nbsp;<strong>initialize()<\/strong>&nbsp;function we will simply use our new&nbsp;<strong>setSpeed(\u2026)<\/strong>&nbsp;function to start the robot forward at&nbsp;<strong>0.75<\/strong> speed.&nbsp;Since we will also be logging the speed, we log the title row for our CSV file. Note the placement of the comma right before &#8220;Target Speed&#8221;. We need this so that it will be formatted in a way that we can easily import it into the spreadsheet.<\/p>\n\n\n\n<pre class=\"wp-block-code\"><code>  \/\/ Called when the command is initially scheduled.\n  @Override\n  public void initialize() {\n    Logger.log(\"TestSpeedControlCommand\", 2, \"initialize()\");\n\n    Logger.log(\"TestSpeedControlCommand\", 3, \"...,Target Speed,Left Speed, Right Speed\");\n\n    m_subsystem.setSpeed(k_speed, k_speed);\n\n  }<\/code><\/pre>\n\n\n\n<p>Note we are using <strong>k_speed<\/strong>, but haven&#8217;t defined it in this class yet!  Add the definition with the class variable, giving it an initial value of <strong>0.75<\/strong>.<\/p>\n\n\n\n<pre class=\"wp-block-code\"><code>public class CalibrateSpeedCommand extends Command {\n  private final DriveSubsystem m_subsystem;\n  private final Encoder m_leftEncoder;\n  private final Encoder m_rightEncoder;\n  private final double k_speed = 0.75;\n<\/code><\/pre>\n\n\n\n<p>In the&nbsp;<strong>execute()<\/strong>&nbsp;function we want to log the current time, power, and speeds of the two motors. Once again. note the comma that precedes the &#8220;<strong>,%.0f,&#8230;<\/strong>&#8221; string.<\/p>\n\n\n\n<pre class=\"wp-block-code\"><code>  \/\/ Called every time the scheduler runs while the command is scheduled.\n  @Override  \n  public void execute() {\n    Logger.log(\"CalibrateSpeedCommand\", -1, \"execute()\");\n\n    Logger.log(\"TestSpeedControl\", 3, String.format(\",%.0f,%d,%d\", k_speed * DriveSubsystem.k_maxSpeed,\n        m_leftEncoder.getSpeed(), m_rightEncoder.getSpeed()));\n  }<\/code><\/pre>\n\n\n\n<p>Note that we are also logging the target speed and we need to multiply&nbsp;<strong>k_speed<\/strong>&nbsp;by the&nbsp;<strong>k_maxSpeed<\/strong>&nbsp;defined in the&nbsp;<strong>DriveSubsystem<\/strong>&nbsp;so that the units will match those returned by the encoder\u2019s&nbsp;<strong>getSpeed()<\/strong>&nbsp;function.<\/p>\n\n\n\n<p>We are going to make this command run as long as we <em>hold down<\/em> joystick button&nbsp;<strong>4<\/strong>, and stop when we <em>release <\/em>it.  This way of stopping execution is handled when we register our command with joystick button <strong>4<\/strong> (we get to it below), and does not rely on the&nbsp;<strong>isFinished()<\/strong>&nbsp;function. So we just want&nbsp;<strong>isFinished()<\/strong>&nbsp;to return&nbsp;<strong>false<\/strong>.  This is the default from <strong>ExampleCommand<\/strong>, so no changes are needed.<\/p>\n\n\n\n<p>When we release button&nbsp;<strong>4<\/strong>&nbsp;on the joystick, the command will be interrupted and it\u2019s&nbsp;end<strong>()<\/strong>&nbsp;function will be called. At that point we need to turn the motors off.<\/p>\n\n\n\n<pre class=\"wp-block-code\"><code>  public void end(boolean interrupted) {\n    Logger.log(\"CalibrateSpeedCommand\", 2, String.format(\"end(%b)\", interrupted));\n\n    m_subsystem.stop();\n  }<\/code><\/pre>\n\n\n\n<p>Your <strong>CalibrateSpeedCommand.java<\/strong> should now look like:<\/p>\n\n\n\n<pre class=\"wp-block-code\"><code>\/*----------------------------------------------------------------------------*\/\n\/* Copyright (c) 2018-2019 FIRST. All Rights Reserved.                        *\/\n\/* Open Source Software - may be modified and shared by FRC teams. The code   *\/\n\/* must be accompanied by the FIRST BSD license file in the root directory of *\/\n\/* the project.                                                               *\/\n\/*----------------------------------------------------------------------------*\/\n\npackage frc.robot.commands;\n\nimport edu.wpi.first.wpilibj2.command.Command;\nimport frc.robot.subsystems.DriveSubsystem;\nimport robotCore.Encoder;\nimport robotCore.Logger;\n\n\/**\n * Calibrates the speed by setting the F, P, I and IZone values.\n *\/\npublic class CalibrateSpeedCommand extends Command {\n  private final DriveSubsystem m_subsystem;\n  private final double k_speed = 0.75;\n\n  private Encoder m_leftEncoder;\n  private Encoder m_rightEncoder;\n\n  \/**\n   * Creates a new CalibrateSpeedCommand.\n   *\n   * @param subsystem The subsystem used by this command.\n   *\/\n  public CalibrateSpeedCommand(DriveSubsystem subsystem) {\n    Logger.log(\"CalibrateSpeedCommand\", 3, \"CalibrateSpeedCommand()\");\n\n    m_subsystem = subsystem;\n    m_leftEncoder =  m_subsystem.getLeftEncoder();\n    m_rightEncoder = m_subsystem.getRightEncoder();\n\n    \/\/ Use addRequirements() here to declare subsystem dependencies.\n    addRequirements(m_subsystem);\n  }\n\n  \/\/ Called when the command is initially scheduled.\n  @Override\n  public void initialize() {\n    Logger.log(\"CalibrateSpeedCommand\", 2, \"initialize()\");\n    \n    Logger.log(\"TestSpeedControlCommand\", 3, \"...,Target Speed,Left Speed, Right Speed\");\n\n    m_subsystem.setSpeed(k_speed, k_speed);\n  }\n\n  \/\/ Called every time the scheduler runs while the command is scheduled.\n  @Override\n  public void execute() {\n    Logger.log(\"CalibrateSpeedCommand\", -1, \"execute()\");\n\n    Logger.log(\"TestSpeedControl\", 3, String.format(\",%.0f,%d,%d\", k_speed * DriveSubsystem.k_maxSpeed,\n    m_leftEncoder.getSpeed(), m_rightEncoder.getSpeed()));\n  }\n\n  \/\/ Called once when the command ends or is interrupted.\n  @Override\n  public void end(boolean interrupted) {\n    Logger.log(\"CalibrateSpeedCommand\", 2, String.format(\"end(%b)\", interrupted));\n\n    m_subsystem.setPower(0, 0);\n  }\n\n  \/\/ Returns true when the command should end.\n  @Override\n  public boolean isFinished() {\n    Logger.log(\"CalibrateSpeedCommand\", -1, \"isFinished()\");\n    return false;\n  }\n}\n<\/code><\/pre>\n\n\n\n<p>Now connect our test button&nbsp;<strong>4<\/strong>&nbsp;to our new&nbsp;<strong>CalibrateSpeedCommand<\/strong>&nbsp;by adding the following to&nbsp;<strong>RobotContainer:<\/strong><\/p>\n\n\n\n<pre class=\"wp-block-code\"><code>  private void configureButtonBindings() {\n    m_joystick.button(1).onTrue(new DriveForTimeCommand(m_driveSubsystem, 0.50, 3.0));\n    m_joystick.button(2).onTrue(new DriveForDistanceCommand(m_driveSubsystem, 0.75, 1000));\n    m_joystick.button(3).onTrue(new TestMotorSpeedCommand(m_driveSubsystem));\n    m_joystick.button(4).whileTrue(new CalibrateSpeedCommand(m_driveSubsystem));\n  }<\/code><\/pre>\n\n\n\n<p>Note we used <strong><em>whileTrue<\/em> <\/strong>instead of <em><strong>onTrue<\/strong><\/em>.  This is what stops the command when the button is released (i.e., when it stops being True).  Both of these are useful, but code different behaviors.  <strong><em>onTrue<\/em> <\/strong>codes for an event &#8211; the button condition changes to True.  <strong><em>whileTrue<\/em> <\/strong>codes for a condition &#8211; the button is currently True. (Aside: In truth, the latter can be implemented with two events, generically buttonDown and buttonUp, but it doesn&#8217;t have to be.  In digital hardware design, these techniques are called &#8220;edge triggered&#8221; and &#8220;level triggered&#8221;.)<\/p>\n\n\n\n<p>Your <strong>RobotContainer.java<\/strong> file should now look like:<\/p>\n\n\n\n<pre class=\"wp-block-code\"><code>\/*----------------------------------------------------------------------------*\/\n\/* Copyright (c) 2018-2019 FIRST. All Rights Reserved.                        *\/\n\/* Open Source Software - may be modified and shared by FRC teams. The code   *\/\n\/* must be accompanied by the FIRST BSD license file in the root directory of *\/\n\/* the project.                                                               *\/\n\/*----------------------------------------------------------------------------*\/\n\npackage frc.robot;\n\nimport edu.wpi.first.wpilibj.XboxController;\nimport edu.wpi.first.wpilibj2.command.Command;\nimport edu.wpi.first.wpilibj2.command.button.CommandJoystick;\nimport frc.robot.commands.ArcadeDriveCommand;\nimport frc.robot.commands.CalibrateSpeedCommand;\nimport frc.robot.commands.DriveForDistanceCommand;\nimport frc.robot.commands.DriveForTimeCommand;\nimport frc.robot.commands.ExampleCommand;\nimport frc.robot.commands.TestMotorSpeedCommand;\nimport frc.robot.subsystems.DriveSubsystem;\nimport frc.robot.subsystems.ExampleSubsystem;\n\n\/**\n * This class is where the bulk of the robot should be declared. Since\n * Command-based is a \"declarative\" paradigm, very little robot logic should\n * actually be handled in the {@link Robot} periodic methods (other than the\n * scheduler calls). Instead, the structure of the robot (including subsystems,\n * commands, and button mappings) should be declared here.\n *\/\npublic class RobotContainer {\n  \/\/ The robot's subsystems and commands are defined here...\n  @SuppressWarnings(\"unused\")\n  private final ExampleSubsystem m_exampleSubsystem = new ExampleSubsystem();\n  private final DriveSubsystem m_driveSubsystem = new DriveSubsystem();\n  private final CommandJoystick m_joystick = new CommandJoystick(0);\n\n  private final ExampleCommand m_autoCommand = null; \/\/ new ExampleCommand(m_exampleSubsystem);\n\n  \/**\n   * The container for the robot. Contains subsystems, OI devices, and commands.\n   *\/\n  public RobotContainer() {\n    m_driveSubsystem.setDefaultCommand(new ArcadeDriveCommand(m_driveSubsystem, m_joystick));\n\n    \/\/ Configure the button bindings\n    configureButtonBindings();\n  }\n\n  \/**\n   * Use this method to define your button-&gt;command mappings. Buttons can be\n   * created by instantiating a {@link GenericHID} or one of its subclasses\n   * ({@link edu.wpi.first.wpilibj.Joystick} or {@link XboxController}), and then\n   * passing it to a {@link edu.wpi.first.wpilibj2.command.button.JoystickButton}.\n   *\/\n  private void configureButtonBindings() {\n    m_joystick.button(1).onTrue(new DriveForTimeCommand(m_driveSubsystem, 0.50, 3.0));\n    m_joystick.button(2).onTrue(new DriveForDistanceCommand(m_driveSubsystem, 0.75, 1000));\n    m_joystick.button(3).onTrue(new TestMotorSpeedCommand(m_driveSubsystem));\n    m_joystick.button(4).whileTrue(new CalibrateSpeedCommand(m_driveSubsystem));\n  }\n\n  \/**\n   * Use this to pass the autonomous command to the main {@link Robot} class.\n   *\n   * @return the command to run in autonomous\n   *\/\n  public Command getAutonomousCommand() {\n    \/\/ An ExampleCommand will run in autonomous\n    return m_autoCommand;\n  }\n}\n<\/code><\/pre>\n\n\n\n<p>Now run your program, and connect and enable your robot. Then, as before, clear the&nbsp;<strong>TERMINAL<\/strong>&nbsp;window in&nbsp;<strong>VS Code<\/strong>. Then switch to the&nbsp;<strong>Driver Station<\/strong>&nbsp;and hold the&nbsp;<strong>B4<\/strong>&nbsp;button down for a few seconds. Go back to&nbsp;<strong>VS Code<\/strong>&nbsp;and copy all of the text in the&nbsp;<strong>TERMINAL<\/strong>&nbsp;window and paste it into&nbsp;<strong>LibreOffice Calc<\/strong>. As before, delete all of the rows up to the header line. Now select the&nbsp;<strong>Target Speed, Left Speed, and Right Speed<\/strong>&nbsp;columns and plot the data. This time, however, choose the&nbsp;<strong>Line \/ Lines Only<\/strong>&nbsp;option as shown below:<\/p>\n\n\n\n<div class=\"wp-block-image\"><figure class=\"aligncenter size-large is-resized\"><a href=\"\/wp-content\/uploads\/2021\/04\/LibreCalc6.jpg\"><img loading=\"lazy\" src=\"\/wp-content\/uploads\/2021\/04\/LibreCalc6.jpg\" alt=\"\" class=\"wp-image-206\" width=\"616\" height=\"305\" srcset=\"http:\/\/gabybot.com\/wp-content\/uploads\/2021\/04\/LibreCalc6.jpg 919w, http:\/\/gabybot.com\/wp-content\/uploads\/2021\/04\/LibreCalc6-300x149.jpg 300w, http:\/\/gabybot.com\/wp-content\/uploads\/2021\/04\/LibreCalc6-768x381.jpg 768w\" sizes=\"(max-width: 616px) 100vw, 616px\" \/><\/a><\/figure><\/div>\n\n\n\n<p>This should result in a graph which looks something like this:<\/p>\n\n\n\n<div class=\"wp-block-image\"><figure class=\"aligncenter size-full is-resized\"><a href=\"\/wp-content\/uploads\/2025\/08\/FTerm.jpg\"><img loading=\"lazy\" src=\"\/wp-content\/uploads\/2025\/08\/FTerm.jpg\" alt=\"\" class=\"wp-image-4790\" width=\"445\" height=\"247\" srcset=\"http:\/\/gabybot.com\/wp-content\/uploads\/2025\/08\/FTerm.jpg 745w, http:\/\/gabybot.com\/wp-content\/uploads\/2025\/08\/FTerm-300x167.jpg 300w, http:\/\/gabybot.com\/wp-content\/uploads\/2025\/08\/FTerm-150x83.jpg 150w\" sizes=\"(max-width: 445px) 100vw, 445px\" \/><\/a><\/figure><\/div>\n\n\n\n<p>The&nbsp;<strong>blue<\/strong>&nbsp;line represents the target speed and the&nbsp;<strong>red<\/strong>&nbsp;and&nbsp;<strong>yellow&nbsp;<\/strong>lines are the actual speeds of the motors. We can see that some of the motors are close and some need to be adjusted. We can find a new value by taking the ratio of the target speed to the actual speed. For example, the average speed of the left motor is <strong>1062 <\/strong>and the target speed is <strong>1100<\/strong>. So we would need to change the <strong>F <\/strong>term by a factor of <strong>1100\/1062<\/strong> or <strong>1.05<\/strong>. We can do the same calculation for the right motor and get about <strong>1.02<\/strong>. Using these new number we redefine our <strong>k_Fleft <\/strong>and <strong>k_Fright <\/strong>constants:<\/p>\n\n\n\n<pre class=\"wp-block-code\"><code>  private static final double k_Fleft = 1.05 \/ k_maxSpeed; \/\/ Use the correct number for your robot!\n  private static final double k_Fright = 1.02 \/ k_maxSpeed; \/\/ Use the correct number for your robot!\n<\/code><\/pre>\n\n\n\n<p>Remember that these numbers are for&nbsp;<strong>this particular robot only<\/strong>. Your robot may behave slightly differently and you should adjust your number accordingly.<\/p>\n\n\n\n<p>Now run your program again and copy the data to LibreOffice Calc and you should get a graph something like:<\/p>\n\n\n\n<div class=\"wp-block-image\"><figure class=\"aligncenter size-full is-resized\"><a href=\"\/wp-content\/uploads\/2025\/08\/FTerm2.jpg\"><img loading=\"lazy\" src=\"\/wp-content\/uploads\/2025\/08\/FTerm2.jpg\" alt=\"\" class=\"wp-image-4794\" width=\"423\" height=\"237\" srcset=\"http:\/\/gabybot.com\/wp-content\/uploads\/2025\/08\/FTerm2.jpg 743w, http:\/\/gabybot.com\/wp-content\/uploads\/2025\/08\/FTerm2-300x167.jpg 300w, http:\/\/gabybot.com\/wp-content\/uploads\/2025\/08\/FTerm2-150x84.jpg 150w\" sizes=\"(max-width: 423px) 100vw, 423px\" \/><\/a><\/figure><\/div>\n\n\n\n<p>Now this is much better and we can see that our robot is already driving much straighter. We can continue to adjust the <strong>F <\/strong>values to try and get it closer to the target, but we don&#8217;t need it to be perfect. The <strong>P <\/strong>and <strong>I <\/strong>terms will compensate for it being a little bit off.<\/p>\n\n\n\n<p>Now that we have the&nbsp;<strong>F<\/strong>&nbsp;term established we are going to work on the&nbsp;<strong>P<\/strong>&nbsp;term. The&nbsp;<strong>P<\/strong>&nbsp;stands for&nbsp;<strong>proportional<\/strong>. What this means is that power is added or subtracted depending on how far off the&nbsp;<strong>actual speed<\/strong>&nbsp;is from the&nbsp;<strong>target speed<\/strong> &#8211; the further we are from the target speed, the more this term will add\/subtract and get it closer. Determining the first guess for the&nbsp;<strong>P<\/strong>&nbsp;term is somewhat difficult so we are just going to try something and see how it works. This term is best used in small doses, so let\u2019s try&nbsp;<strong>0.001<\/strong>&nbsp;(in this case we won\u2019t need to use different values for the two motors).<\/p>\n\n\n\n<p>To set the&nbsp;<strong>P<\/strong>&nbsp;term we add the following to the <strong>DriveSubsystem <\/strong>constructor:<\/p>\n\n\n\n<pre class=\"wp-block-code\"><code>    m_leftMotor.setPTerm(k_P);\n    m_rightMotor.setPTerm(k_P);<\/code><\/pre>\n\n\n\n<p>And defining&nbsp;<strong>k_P<\/strong>&nbsp;as follows:<\/p>\n\n\n\n<pre class=\"wp-block-code\"><code>   private static final double k_P = 0.0005;<\/code><\/pre>\n\n\n\n<p>Using this value, we get the following graph:<\/p>\n\n\n\n<div class=\"wp-block-image\"><figure class=\"aligncenter size-full is-resized\"><a href=\"\/wp-content\/uploads\/2025\/08\/P0.005.jpg\"><img loading=\"lazy\" src=\"\/wp-content\/uploads\/2025\/08\/P0.005.jpg\" alt=\"\" class=\"wp-image-4798\" width=\"440\" height=\"246\" srcset=\"http:\/\/gabybot.com\/wp-content\/uploads\/2025\/08\/P0.005.jpg 744w, http:\/\/gabybot.com\/wp-content\/uploads\/2025\/08\/P0.005-300x168.jpg 300w, http:\/\/gabybot.com\/wp-content\/uploads\/2025\/08\/P0.005-150x84.jpg 150w\" sizes=\"(max-width: 440px) 100vw, 440px\" \/><\/a><\/figure><\/div>\n\n\n\n<p>We can see that this graph already looks better than the previous one that did not have a&nbsp;<strong>P<\/strong>&nbsp;term.&nbsp;Now what we want is the largest value of&nbsp;<strong>P<\/strong>&nbsp;that does not make the robot unstable. If&nbsp;<strong>P<\/strong>&nbsp;is too large, the robot will start to oscillate and we don\u2019t want that. So what we are going to do is keep increasing the value of&nbsp;<strong>P<\/strong>&nbsp;until we see it become unstable, and then back off.<\/p>\n\n\n\n<p>In my case, I kept increasing <strong>P<\/strong> until I reached <strong>0.05<\/strong> at which point my graph looked like:<\/p>\n\n\n\n<div class=\"wp-block-image\"><figure class=\"aligncenter size-full is-resized\"><a href=\"\/wp-content\/uploads\/2025\/08\/P0.05.jpg\"><img loading=\"lazy\" src=\"\/wp-content\/uploads\/2025\/08\/P0.05.jpg\" alt=\"\" class=\"wp-image-4799\" width=\"391\" height=\"220\" srcset=\"http:\/\/gabybot.com\/wp-content\/uploads\/2025\/08\/P0.05.jpg 750w, http:\/\/gabybot.com\/wp-content\/uploads\/2025\/08\/P0.05-300x168.jpg 300w, http:\/\/gabybot.com\/wp-content\/uploads\/2025\/08\/P0.05-150x84.jpg 150w\" sizes=\"(max-width: 391px) 100vw, 391px\" \/><\/a><\/figure><\/div>\n\n\n\n<p>We can see that it has become unstable. So at this point I decreased the <strong>P<\/strong> value and settled on a <strong>P<\/strong> of <strong>0.001<\/strong> which looked like:<\/p>\n\n\n\n<div class=\"wp-block-image\"><figure class=\"aligncenter size-full is-resized\"><a href=\"\/wp-content\/uploads\/2025\/08\/P0.001.jpg\"><img loading=\"lazy\" src=\"\/wp-content\/uploads\/2025\/08\/P0.001.jpg\" alt=\"\" class=\"wp-image-4800\" width=\"377\" height=\"209\" srcset=\"http:\/\/gabybot.com\/wp-content\/uploads\/2025\/08\/P0.001.jpg 745w, http:\/\/gabybot.com\/wp-content\/uploads\/2025\/08\/P0.001-300x167.jpg 300w, http:\/\/gabybot.com\/wp-content\/uploads\/2025\/08\/P0.001-150x83.jpg 150w\" sizes=\"(max-width: 377px) 100vw, 377px\" \/><\/a><\/figure><\/div>\n\n\n\n<p>Now adding the&nbsp;<strong>P<\/strong>&nbsp;term helps a lot but if the robot were to encounter some additional resistance (such as going up a ramp) it would not be able to completely compensate. For that we need the&nbsp;<strong>I<\/strong>&nbsp;term.<\/p>\n\n\n\n<p>The&nbsp;<strong>I<\/strong>&nbsp;stands for integral. What the<strong>&nbsp;PID controller<\/strong>&nbsp;does is run in a loop. Each time through the loop it computes an&nbsp;<strong>error term<\/strong>&nbsp;which is the difference between the set point and the actual speed. The&nbsp;<strong>P<\/strong>&nbsp;term then multiplies that&nbsp;<strong>error term<\/strong>&nbsp;to make it\u2019s adjustment. However, the&nbsp;<strong>PID<\/strong>&nbsp;loop also keeps track of a&nbsp;<strong>total error<\/strong>,&nbsp;and each time through the loop its <strong>error term<\/strong>&nbsp;is added to the<strong>&nbsp;total error<\/strong>. The&nbsp;<strong>I<\/strong>&nbsp;term is then multiplied by the&nbsp;<strong>total error<\/strong>&nbsp;and that is added to the power equation. <\/p>\n\n\n\n<p>So, lets say, that the speed is too low because the robot is going up a ramp. As long as the speed is too slow, the&nbsp;<strong>total error<\/strong>&nbsp;will continue to increase which will cause the power applied to continue to increase until there is enough power to maintain the correct speed.<\/p>\n\n\n\n<p>Once again choosing an initial value for the&nbsp;<strong>I<\/strong>&nbsp;term is difficult and we will have to make a guess. Like the <strong>P<\/strong> correction factor, its best to start small. Let\u2019s start with&nbsp;<strong>0.001<\/strong>. We set the&nbsp;<strong>I<\/strong>&nbsp;term like this:(again, in the <strong>DriveSubsystem <\/strong>constructor):<\/p>\n\n\n\n<pre class=\"wp-block-code\"><code>    m_leftMotor.setITerm(k_I);\n    m_rightMotor.setITerm(k_I);<\/code><\/pre>\n\n\n\n<p>Defining&nbsp;<strong>k_I<\/strong>&nbsp;as follows:<\/p>\n\n\n\n<pre class=\"wp-block-code\"><code>  private static final double k_I = 0.001; <\/code><\/pre>\n\n\n\n<p>There is one last thing we need to do before we run our program. Using the&nbsp;<strong>I<\/strong>&nbsp;term is great but really only works when our speed is close to the&nbsp;<strong>target value<\/strong>. When we first start the robot, it takes some time for the robot to get up to speed and during that time we build up a large&nbsp;<strong>total error<\/strong>&nbsp;term. This then causes us to overshoot our target. Eventually it settles down to the correct value but we don\u2019t want the overshoot. The way to prevent this is to only use the&nbsp;<strong>I<\/strong>&nbsp;term when the&nbsp;<strong>current speed<\/strong>&nbsp;is close to the&nbsp;<strong>target speed<\/strong>. <\/p>\n\n\n\n<p>We set this range by using the&nbsp;<strong><a rel=\"noreferrer noopener\" href=\"\/RobotCoreDoc\/classrobot_core_1_1_smart_motor.html#a1f67efaae869080b3b7f3baa57c821a7\" target=\"_blank\">setIZone()<\/a><\/strong>&nbsp;function. We need to set the zone large enough that it encompasses the natural oscillation of the motors. Looking at the graphs we can see the motor speeds aren&#8217;t straight lines, but they stay within a narrow range. This range is around&nbsp;<strong>50<\/strong>. Set the&nbsp;<strong>I Zone<\/strong>&nbsp;as follows:<\/p>\n\n\n\n<pre class=\"wp-block-code\"><code>    m_leftMotor.setIZone(k_IZone);\n    m_rightMotor.setIZone(k_IZone);<\/code><\/pre>\n\n\n\n<p>Defining&nbsp;<strong>k_IZone<\/strong>&nbsp;as:<\/p>\n\n\n\n<pre class=\"wp-block-code\"><code>  private static final double k_IZone = 50;<\/code><\/pre>\n\n\n\n<p>Now we run the program and, as with the <strong>P<\/strong> term, we continue to increase the <strong>I<\/strong> term until it becomes unstable and then we back off to the last stable value. For me I settled on an <strong>I<\/strong> of <strong>0.001<\/strong> which game me a graph like:<\/p>\n\n\n\n<div class=\"wp-block-image\"><figure class=\"aligncenter size-full is-resized\"><a href=\"\/wp-content\/uploads\/2025\/08\/I0.001.jpg\"><img loading=\"lazy\" src=\"\/wp-content\/uploads\/2025\/08\/I0.001.jpg\" alt=\"\" class=\"wp-image-4805\" width=\"413\" height=\"231\" srcset=\"http:\/\/gabybot.com\/wp-content\/uploads\/2025\/08\/I0.001.jpg 742w, http:\/\/gabybot.com\/wp-content\/uploads\/2025\/08\/I0.001-300x168.jpg 300w, http:\/\/gabybot.com\/wp-content\/uploads\/2025\/08\/I0.001-150x84.jpg 150w\" sizes=\"(max-width: 413px) 100vw, 413px\" \/><\/a><\/figure><\/div>\n\n\n\n<p>Your <strong>DriveSubsystem.java<\/strong> file should now look something like:<\/p>\n\n\n\n<pre class=\"wp-block-code\"><code>\/*----------------------------------------------------------------------------*\/\n\/* Copyright (c) 2018-2019 FIRST. All Rights Reserved.                        *\/\n\/* Open Source Software - may be modified and shared by FRC teams. The code   *\/\n\/* must be accompanied by the FIRST BSD license file in the root directory of *\/\n\/* the project.                                                               *\/\n\/*----------------------------------------------------------------------------*\/\n\npackage frc.robot.subsystems;\n\nimport edu.wpi.first.wpilibj2.command.SubsystemBase;\nimport robotCore.Logger;\nimport robotCore.Minibot;\nimport robotCore.PWMMotor;\nimport robotCore.SmartMotor.SmartMotorMode;\nimport robotCore.Encoder;\nimport robotCore.Encoder.EncoderType;\n\npublic class DriveSubsystem extends SubsystemBase {\n  private PWMMotor m_leftMotor = new PWMMotor(Minibot.LeftMotorPWM, Minibot.LeftMotorDir);\n  private PWMMotor m_rightMotor = new PWMMotor(Minibot.RightMotorPWM, Minibot.RightMotorDir);\n  private Encoder m_leftEncoder = new Encoder(EncoderType.Quadrature, Minibot.LeftEncoderInt, Minibot.LeftEncoderDir);\n  private Encoder m_rightEncoder = new Encoder(EncoderType.Quadrature, Minibot.RightEncoderInt,\n      Minibot.RightEncoderDir);\n\n  public static final double k_maxSpeed = 1480; \/\/ Use the correct number for your robot!\n  public static final double k_minLeftPower = 0.38; \/\/ Use the correct number for your robot!\n  public static final double k_minRightPower = 0.36; \/\/ Use the correct number for your robot!\n  private static final double k_Fleft = 1.05 \/ k_maxSpeed; \/\/ Use the correct number for your robot!\n  private static final double k_Fright = 1.02 \/ k_maxSpeed; \/\/ Use the correct number for your robot!\n  private static final double k_P = 0.001;\n  private static final double k_I = 0.002;\n  private static final double k_IZone = 50;\n\n  \/**\n   * Creates a new DriveSubsystem.\n   *\/\n  public DriveSubsystem() {\n    Logger.log(\"DriveSubsystem\", 3, \"DriveSubsystem()\");\n\n    m_rightEncoder.setInverted(true);\n\n    m_leftMotor.setMinPower(k_minLeftPower);\n    m_rightMotor.setMinPower(k_minRightPower);\n    m_leftMotor.setFTerm(k_Fleft);\n    m_rightMotor.setFTerm(k_Fright);\n    m_leftMotor.setFeedbackDevice(m_leftEncoder);\n    m_rightMotor.setFeedbackDevice(m_rightEncoder);\n    m_leftMotor.setMaxSpeed(k_maxSpeed);\n    m_rightMotor.setMaxSpeed(k_maxSpeed);\n    m_leftMotor.setPTerm(k_P);\n    m_rightMotor.setPTerm(k_P);\n    m_leftMotor.setITerm(k_I);\n    m_rightMotor.setITerm(k_I);\n    m_leftMotor.setIZone(k_IZone);\n    m_rightMotor.setIZone(k_IZone);\n  }\n\n  public void setPower(double leftPower, double rightPower) {\n    m_leftMotor.setControlMode(SmartMotorMode.Power);\n    m_rightMotor.setControlMode(SmartMotorMode.Power);\n\n    m_rightMotor.set(rightPower);\n    m_leftMotor.set(leftPower);\n  }\n\n  public void setSpeed(double leftSpeed, double rightSpeed) {\n    m_leftMotor.setControlMode(SmartMotorMode.Speed);\n    m_rightMotor.setControlMode(SmartMotorMode.Speed);\n\n    m_leftMotor.set(leftSpeed);\n    m_rightMotor.set(rightSpeed);\n  }\n\n  public void stop() {\n    setPower(0, 0);\n  }\n\n  \/\/ Return the left encoder value\n  public Encoder getLeftEncoder() {\n    return (m_leftEncoder);\n  }\n\n  \/\/ Return the right encoder value\n  public Encoder getRightEncoder() {\n    return (m_rightEncoder);\n  }\n\n  @Override\n  public void periodic() {\n    \/\/ This method will be called once per scheduler run\n    Logger.log(\"DriveSubsystem\", -1, \"periodic()\");\n  }\n}\n<\/code><\/pre>\n\n\n\n<p>Remember that the actual values for the&nbsp;<strong>F<\/strong>,&nbsp;<strong>I<\/strong>, and&nbsp;<strong>P<\/strong>&nbsp;terms for your robot may differ from the ones shown here.<\/p>\n\n\n\n<p>Before we wrap up, let\u2019s see how it behaves at another other speeds. Here are my graphs for 0.75, 0.5, and 0.25:<\/p>\n\n\n\n<div class=\"wp-block-image\"><figure class=\"aligncenter size-full is-resized\"><a href=\"\/wp-content\/uploads\/2025\/08\/Speeds.jpg\"><img loading=\"lazy\" src=\"\/wp-content\/uploads\/2025\/08\/Speeds.jpg\" alt=\"\" class=\"wp-image-4807\" width=\"417\" height=\"236\" srcset=\"http:\/\/gabybot.com\/wp-content\/uploads\/2025\/08\/Speeds.jpg 743w, http:\/\/gabybot.com\/wp-content\/uploads\/2025\/08\/Speeds-300x170.jpg 300w, http:\/\/gabybot.com\/wp-content\/uploads\/2025\/08\/Speeds-150x85.jpg 150w\" sizes=\"(max-width: 417px) 100vw, 417px\" \/><\/a><\/figure><\/div>\n\n\n\n<p>We can see that it looks pretty good. There is a bit of an overshoot at the beginning for the 0.25 speed. We could probably reduce it by lowering either the P or I terms but it is not too bad so we will not muck with the <strong>PID<\/strong> values. The fact is, <em>no single set of&nbsp;<strong>PID<\/strong>&nbsp;terms is going to work for all speeds<\/em>. When tuning your robot you should tune it for the speed that is most important. You should then check other speeds and adjust the&nbsp;<strong>PID<\/strong>&nbsp;parameters only if there is a serious problem.<\/p>\n\n\n\n<p>Let\u2019s make one last change before we move on. &nbsp;Change the call to&nbsp;<strong>setPower<\/strong>&nbsp;in the&nbsp;<strong>ArcadeDrive()<\/strong>&nbsp;function to&nbsp;<strong>setSpeed<\/strong>. &nbsp;This will allow us to control the robot by&nbsp;<strong>speed<\/strong>&nbsp;even during&nbsp;<strong>teleop<\/strong>&nbsp;which can make it easier to control your robot, especially if the two motors run at different speeds for the same power setting. <\/p>\n\n\n\n<p>When you do this you may find that when the robot is stopped the motors jiggle a little bit. This is because trying to control a zero speed with PID can be problematic. You can eliminate this by reducing the P and\/or I terms but a better way is that if the joystick x and y values are below a certain &#8220;dead zone&#8221; simply turn the motors off.<\/p>\n\n\n\n<p>If you implement this idea, your&nbsp;<strong>ArcadeDriveCommand.java<\/strong>&nbsp;file should now look something like:<\/p>\n\n\n\n<pre class=\"wp-block-code\"><code>\/*----------------------------------------------------------------------------*\/\n\/* Copyright (c) 2018-2019 FIRST. All Rights Reserved.                        *\/\n\/* Open Source Software - may be modified and shared by FRC teams. The code   *\/\n\/* must be accompanied by the FIRST BSD license file in the root directory of *\/\n\/* the project.                                                               *\/\n\/*----------------------------------------------------------------------------*\/\n\npackage frc.robot.commands;\n\nimport edu.wpi.first.wpilibj2.command.Command;\nimport edu.wpi.first.wpilibj2.command.button.CommandJoystick;\nimport frc.robot.subsystems.DriveSubsystem;\nimport robotCore.Logger;\n\n\/**\n * A command to test the relationship between power and speed.\n *\/\npublic class ArcadeDriveCommand extends Command {\n  private final DriveSubsystem m_subsystem;\n  private final CommandJoystick m_joystick;\n  private final static double k_deadZone = 0.05;\n\n  \/**\n   * Creates a new ArcadeDriveCommand.\n   *\n   * @param subsystem The subsystem used by this command.\n   *\/\n  public ArcadeDriveCommand(DriveSubsystem subsystem, CommandJoystick joystick) {\n    Logger.log(\"ArcadeDriveCommand\", 3, \"ArcadeDriveCommand()\");\n\n    m_subsystem = subsystem;\n    m_joystick = joystick;\n\n    \/\/ Use addRequirements() here to declare subsystem dependencies.\n    addRequirements(m_subsystem);\n  }\n\n  \/\/ Called when the command is initially scheduled.\n  @Override\n  public void initialize() {\n    Logger.log(\"ArcadeDriveCommand\", 2, \"initialize()\");\n  }\n\n  \/\/ Called every time the scheduler runs while the command is scheduled.\n  @Override\n  public void execute() {\n    Logger.log(\"ArcadeDriveCommand\", -1, \"execute()\");\n\n    double y = m_joystick.getY();\n    double x = m_joystick.getX();\n\n    x = Math.abs(x) * x;\n    y = Math.abs(y) * y;\n\n    if ((Math.abs(x) &lt; k_deadZone) &amp;&amp; (Math.abs(y) &lt; k_deadZone)) {\n      m_subsystem.stop();\n    }\n    else {\n      m_subsystem.setSpeed(y + x, y - x);\n    }\n  }\n\n  \/\/ Called once the command ends or is interrupted.\n  @Override\n  public void end(boolean interrupted) {\n    Logger.log(\"ArcadeDriveCommand\", 2, String.format(\"end(%b)\", interrupted));\n  }\n\n  \/\/ Returns true when the command should end.\n  @Override\n  public boolean isFinished() {\n    Logger.log(\"ArcadeDriveCommand\", -1, \"isFinished()\");\n    return false;\n  }\n}\n<\/code><\/pre>\n\n\n\n<p><a href=\"\/drive-straight\/\" data-type=\"page\">Next: Drive Straight<\/a><\/p>\n\n\n\n<p><strong><span style=\"text-decoration: underline;\">Optional: Another Way to Clear the Terminal Window<\/span><\/strong><\/p>\n\n\n\n<p>Make sure the <strong>TERMINAL<\/strong> terminal window is showing at the bottom of VSCode by (1) clicking the word <em>TERMINAL<\/em>.  Then (2) left-click the three dots on the right (near the &#8220;X&#8221; in the corner).<\/p>\n\n\n\n<figure class=\"wp-block-image size-full\"><img loading=\"lazy\" width=\"729\" height=\"265\" src=\"http:\/\/programming.team2102.org\/wp-content\/uploads\/2024\/09\/Clear-Terminal-Window.png\" alt=\"\" class=\"wp-image-3469\" srcset=\"http:\/\/gabybot.com\/wp-content\/uploads\/2024\/09\/Clear-Terminal-Window.png 729w, http:\/\/gabybot.com\/wp-content\/uploads\/2024\/09\/Clear-Terminal-Window-300x109.png 300w, http:\/\/gabybot.com\/wp-content\/uploads\/2024\/09\/Clear-Terminal-Window-150x55.png 150w\" sizes=\"(max-width: 729px) 100vw, 729px\" \/><\/figure>\n\n\n\n<p>This will bring up a window with a <em>Clear Terminal<\/em> option.  Click it to clear the window.<\/p>\n\n\n\n<figure class=\"wp-block-image size-full\"><img loading=\"lazy\" width=\"495\" height=\"219\" src=\"http:\/\/programming.team2102.org\/wp-content\/uploads\/2024\/09\/Clear-Terminal-Item.png\" alt=\"\" class=\"wp-image-3470\" srcset=\"http:\/\/gabybot.com\/wp-content\/uploads\/2024\/09\/Clear-Terminal-Item.png 495w, http:\/\/gabybot.com\/wp-content\/uploads\/2024\/09\/Clear-Terminal-Item-300x133.png 300w, http:\/\/gabybot.com\/wp-content\/uploads\/2024\/09\/Clear-Terminal-Item-150x66.png 150w\" sizes=\"(max-width: 495px) 100vw, 495px\" \/><\/figure>\n\n\n\n<p>ALTERNATIVELY, if the <em>Clear Terminal <\/em>icon shows up, click it instead!<\/p>\n\n\n\n<figure class=\"wp-block-image size-full\"><img loading=\"lazy\" width=\"366\" height=\"90\" src=\"http:\/\/programming.team2102.org\/wp-content\/uploads\/2024\/09\/Clear-Terminal-Icon.png\" alt=\"\" class=\"wp-image-3471\" srcset=\"http:\/\/gabybot.com\/wp-content\/uploads\/2024\/09\/Clear-Terminal-Icon.png 366w, http:\/\/gabybot.com\/wp-content\/uploads\/2024\/09\/Clear-Terminal-Icon-300x74.png 300w, http:\/\/gabybot.com\/wp-content\/uploads\/2024\/09\/Clear-Terminal-Icon-150x37.png 150w\" sizes=\"(max-width: 366px) 100vw, 366px\" \/><\/figure>\n\n\n\n<p><a href=\"\/drive-straight\/\" data-type=\"page\">Next: Drive Straight<\/a><\/p>\n","protected":false},"excerpt":{"rendered":"<p>Now that we know how to use the encoders, we want to change our&nbsp;DriveSubsystem&nbsp;class so that we can set the motors to run at a specific speed by automatically&nbsp;adjusting the power of the motors to maintain that speed. Before we tackle that, however, we need to gather some information as to the relationship between the&hellip;&nbsp;<a href=\"http:\/\/gabybot.com\/speed-control\/\" class=\"\" rel=\"bookmark\">Read More &raquo;<span class=\"screen-reader-text\">Speed Control<\/span><\/a><\/p>\n","protected":false},"author":2,"featured_media":0,"parent":0,"menu_order":0,"comment_status":"closed","ping_status":"open","template":"","meta":{"neve_meta_sidebar":"","neve_meta_container":"","neve_meta_enable_content_width":"","neve_meta_content_width":0,"neve_meta_title_alignment":"","neve_meta_author_avatar":"","neve_post_elements_order":"","neve_meta_disable_header":"","neve_meta_disable_footer":"","neve_meta_disable_title":""},"_links":{"self":[{"href":"http:\/\/gabybot.com\/wp-json\/wp\/v2\/pages\/176"}],"collection":[{"href":"http:\/\/gabybot.com\/wp-json\/wp\/v2\/pages"}],"about":[{"href":"http:\/\/gabybot.com\/wp-json\/wp\/v2\/types\/page"}],"author":[{"embeddable":true,"href":"http:\/\/gabybot.com\/wp-json\/wp\/v2\/users\/2"}],"replies":[{"embeddable":true,"href":"http:\/\/gabybot.com\/wp-json\/wp\/v2\/comments?post=176"}],"version-history":[{"count":171,"href":"http:\/\/gabybot.com\/wp-json\/wp\/v2\/pages\/176\/revisions"}],"predecessor-version":[{"id":4881,"href":"http:\/\/gabybot.com\/wp-json\/wp\/v2\/pages\/176\/revisions\/4881"}],"wp:attachment":[{"href":"http:\/\/gabybot.com\/wp-json\/wp\/v2\/media?parent=176"}],"curies":[{"name":"wp","href":"https:\/\/api.w.org\/{rel}","templated":true}]}}